{{ block title }}
  Payoffs
{{ endblock }}

{{ block content }}
<head>
  <link rel="stylesheet" type="text/css" href="{{ static 'styles.css'}}">
</head>

<!-- Text -->
<p>To incentivize your choices, round payoffs are determined by the decisions of both the Buyer and the Seller:</p>
<ul>
  <li>Sellers make $4 plus $4 per widget sold to the Buyer</li>
  <li>
    Buyers have an ideal quantity of widgets that they wish to purchase, X, determined by a six-sided die roll. The buyer’s payoff is determined by how far away M is from the ideal quantity X.
    <p>
      <br>
      Buyers earn $30 if they purchase their ideal amount (M=X), but lose $5 for each widget purchased above or below their ideal quantity (with the additional loss falling to $1 once below $5).
    </p>
  </li>
</ul>
<p>So, based on the Buyer’s ideal quantity X, and the number of widgets purchased M, the payoffs to the Seller and Buyer are given in the table below (also printed out at your desks):</p>
<br>
<br>

<!-- Payoffs Table -->
<table class="tg" id="payoffTable">
  <colgroup>
    <col style="width: 190.2px">
    <col style="width: 190.2px">
    <col style="width: 190.2px">
    <col style="width: 190.2px">
    <col style="width: 190.2px">
    <col style="width: 190.2px">
    <col style="width: 190.2px">
    <col style="width: 190.2px">
    <col style="width: 190.2px">
    <col style="width: 190.2px">
  </colgroup>
  <thead>
    <tr>
      <th class="tg-c3ow" rowspan="2">Widgets <br>Purchased, M</th>
      <th class="tg-c3ow" rowspan="2">Your Payoff <br> (X=<span id="selectedX">-</span>)</th>
      <th class="tg-c3ow" rowspan="2">Seller <br> Payoff</th>
      <th class="tg-c3ow" colspan="6">Buyer Payoff (by ideal quantity X)</th>
    </tr>
    <tr>
      <th class="tg-0lax">X=1</th>
      <th class="tg-0lax">X=2</th>
      <th class="tg-0lax">X=3</th>
      <th class="tg-0lax">X=4</th>
      <th class="tg-0lax">X=5</th>
      <th class="tg-0lax">X=6</th>
    </tr>
  </thead>
  <tbody id="tableBody">
    <!-- Table body will be populated dynamically -->
  </tbody>
</table>

    <!-- Include JavaScript file -->
    <script>

      const selectedX = js_vars.selectedX;


    // Section to dynamically create the table

  // Define your JavaScript dictionary with table values
  var tableData = {
    "M=0": ["$4", "$25", "$20", "$15", "$10", "$5", "$4"],
    "M=1": ["$8", "$30", "$25", "$20", "$15", "$10", "$5"],
    "M=2": ["$12", "$25", "$30", "$25", "$20", "$15", "$10"],
    "M=3": ["$16", "$20", "$25", "$30", "$25", "$20", "$15"],
    "M=4": ["$20", "$15", "$20", "$25", "$30", "$25", "$20"],
    "M=5": ["$24", "$10", "$15", "$20", "$25", "$30", "$25"],
    "M=6": ["$28", "$5", "$10", "$15", "$20", "$25", "$30"],
    "M=7": ["$32", "$4", "$5", "$10", "$15", "$20", "$25"],
    "M=8": ["$36", "$3", "$4", "$5", "$10", "$15", "$20"]
  };

  // Function to update the Your Payoff column based on selectedX
function updateYourPayoffColumn(selectedX) {
    var yourPayoffColumnHeader = document.querySelector("#payoffTable th:nth-child(2)");

    // Check if selectedX is a valid number
    if (typeof selectedX === 'number' && selectedX >= 1 && selectedX <= 6) {
        var yourPayoffColumn = document.getElementById("selectedX");
        yourPayoffColumn.textContent = selectedX;

        // Copy the corresponding Buyer Payoff column
        var buyerPayoffColumnIndex = selectedX + 1; // Buyer Payoff columns start from index 2
        var tableRows = document.querySelectorAll("#tableBody tr");
        tableRows.forEach(function(row, index) {
            var cell = row.children[buyerPayoffColumnIndex].cloneNode(true);
            row.insertBefore(cell, row.children[1]); // Insert before the 2nd cell
        });

        // Show the Your Payoff column and header
        yourPayoffColumnHeader.style.display = '';
        var tableRows = document.querySelectorAll("#tableBody tr");
        tableRows.forEach(function(row, index) {
            row.children[1].style.display = ''; // Show the 2nd cell (Your Payoff column)
        });
    } else {
        // Populate the "Your Payoff" column with all 0 values, this allows for the spacing to remain constant
        var tableRows = document.querySelectorAll("#tableBody tr");
        tableRows.forEach(function(row, index) {
            var cell = document.createElement("td");
            cell.className = "tg-0pky";
            cell.textContent = "$0"; // Populate with 0 value
            row.insertBefore(cell, row.children[1]); // Insert before the 2nd cell
        });

        // Hide the Your Payoff column and header so that the table can be used in all pages
        yourPayoffColumnHeader.style.display = 'none';
        var tableRows = document.querySelectorAll("#tableBody tr");
        tableRows.forEach(function(row, index) {
            row.children[1].style.display = 'none'; // Hide the 2nd cell (Your Payoff column)
        });
    }
}




  // Get the table body element
  var tbody = document.getElementById("tableBody");

  // Loop through the dictionary and populate the table
  Object.keys(tableData).forEach(function(key) {
    var row = document.createElement("tr");
    var rowData = tableData[key];
    var cellM = document.createElement("td");
    cellM.className = "tg-0pky";
    cellM.textContent = key;
    row.appendChild(cellM);
    rowData.forEach(function(value) {
      var cell = document.createElement("td");
      cell.className = "tg-0pky";
      cell.textContent = value;
      row.appendChild(cell);
    });
    tbody.appendChild(row);
  });

  updateYourPayoffColumn(selectedX); // Initial update

    </script>
{{ endblock }}
